SELECT `record`.`id` AS `record_id`,`record`.`user_id` AS `user_id`,`record`.`area` AS `area`, `record`.`price` AS `price`,`record`.`ping` AS `ping`,`record`.`style` AS `style`, `record`.`type` AS `type`,`record`.`times` AS `record_times`,`items`.`main_id`, `items`.`times` AS `items_times`,`items`.`click_map` AS `click_map`, `items`.`add_favorite` AS `add_favorite`,`items`.`last_time` AS `last_time`, (SELECT (SUM(`type_value`) / COUNT(`id`)) FROM ex_record_items_stay WHERE `type_key`= 'stay_time' and `record_items_id` = `items`.`id`) AS `item_stay_time` FROM `ex_record` `record`,`ex_record_items` `items` WHERE `record`.`id` = `items`.`record_id` AND (`items`.`times` > 1 OR `items`.`add_favorite` = 1) AND `items`.`last_time` >= (NOW() - INTERVAL 180 DAY) AND (SELECT COUNT(`id`) FROM `ex_main` WHERE `id` = `items`.`main_id`) > 0